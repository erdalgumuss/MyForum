<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Profil</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header>
        <h1>FIXIT FORUM</h1>
        <nav>
            <ul>
                <li><a href="/">Anasayfa</a></li>
                <li><a href="/profile">Profil</a></li>
                <li><a href="/logout" id="logout-btn">Çıkış</a></li>
            </ul>
        </nav>
    </header>

    <main id="content">
        <h2>Kullanıcı Profili</h2>
        <div id="profile-info">
            <div id="profile-picture">
                <!-- Kullanıcı resmi burada gösterilecek -->
                <img src="/static/images/default-profile.png" alt="Profil Resmi">
            </div>
            <div id="profile-details">
                <h3 id="user-name">Kullanıcı Adı</h3>
                <p id="user-email">email@example.com</p>
            </div>
        </div>
        <div id="user-posts">
            <h3>Paylaşılan Gönderiler</h3>
            <div id="posts-container">
                <!-- Kullanıcının gönderileri burada listelenecek -->
            </div>
        </div>
        <div id="user-likes">
            <h3>Beğeniler</h3>
            <ul id="likes-list">
                <!-- Kullanıcının beğendiği gönderiler burada listelenecek -->
            </ul>
        </div>
        <div id="user-comments">
            <h3>Yorumlar</h3>
            <ul id="comments-list">
                <!-- Kullanıcının yaptığı yorumlar burada listelenecek -->
            </ul>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Forum Sitesi</p>
    </footer>

    <script src="/static/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logout-btn');
            const userNameElement = document.getElementById('user-name');
            const userEmailElement = document.getElementById('user-email');
            const profilePictureElement = document.querySelector('#profile-picture img');
            const postsContainer = document.getElementById('posts-container');
            const likesList = document.getElementById('likes-list');
            const commentsList = document.getElementById('comments-list');

            const toggleUserUI = (isLoggedIn) => {
                logoutBtn.style.display = isLoggedIn ? 'inline' : 'none';
            };

            const loadUser = async () => {
                try {
                    const response = await fetch('/models/user');
                    const user = await response.json();
                    if (response.ok) {
                        toggleUserUI(true);
                        userNameElement.textContent = `${user.name} ${user.surname}`;
                        userEmailElement.textContent = user.email;
                        profilePictureElement.src = user.profilePicture || '/static/images/default-profile.png';

                        // Kullanıcının gönderilerini yükle
                        loadUserPosts(user.id);
                        // Kullanıcının beğenilerini yükle
                        loadUserLikes(user.id);
                        // Kullanıcının yorumlarını yükle
                        loadUserComments(user.id);
                    } else {
                        toggleUserUI(false);
                    }
                } catch (error) {
                    console.error('Error loading user:', error);
                    toggleUserUI(false);
                }
            };

            const loadUserPosts = async (userId) => {
                try {
                    const response = await fetch(`/user/${userId}/posts`);
                    const posts = await response.json();
                    postsContainer.innerHTML = ''; // Mevcut içeriği temizle
                    posts.forEach(post => {
                        const postElement = document.createElement('div');
                        postElement.classList.add('post');
                        postElement.innerHTML = `
                            <h4>${post.title}</h4>
                            <p>${post.content}</p>
                        `;
                        postsContainer.appendChild(postElement);
                    });
                } catch (error) {
                    console.error('Error loading user posts:', error);
                }
            };

            const loadUserLikes = async (userId) => {
                try {
                    const response = await fetch(`/user/${userId}/likes`);
                    const likes = await response.json();
                    likesList.innerHTML = ''; // Mevcut içeriği temizle
                    likes.forEach(like => {
                        const likeElement = document.createElement('li');
                        likeElement.textContent = like.postTitle;
                        likesList.appendChild(likeElement);
                    });
                } catch (error) {
                    console.error('Error loading user likes:', error);
                }
            };

            const loadUserComments = async (userId) => {
                try {
                    const response = await fetch(`/user/${userId}/comments`);
                    const comments = await response.json();
                    commentsList.innerHTML = ''; // Mevcut içeriği temizle
                    comments.forEach(comment => {
                        const commentElement = document.createElement('li');
                        commentElement.innerHTML = `
                            <strong>${comment.postTitle}</strong>: ${comment.content}
                        `;
                        commentsList.appendChild(commentElement);
                    });
                } catch (error) {
                    console.error('Error loading user comments:', error);
                }
            };

            loadUser();

            logoutBtn.addEventListener('click', async (event) => {
                event.preventDefault();
                try {
                    const response = await fetch('/logout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    if (response.ok) {
                        const responseData = await response.json();
                        alert(responseData.message);
                        localStorage.removeItem('user');
                        toggleUserUI(false);
                        window.location.href = "/";  // Logout işleminden sonra anasayfaya yönlendirin
                    } else {
                        const responseData = await response.json();
                        alert(responseData.error);
                    }
                } catch (error) {
                    console.error('Logout request failed:', error);
                }
            });
        });
    </script>
</body>
</html>
